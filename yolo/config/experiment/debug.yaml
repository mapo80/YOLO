# =============================================================================
# Debug/Test Configuration - Fast iteration for development
# =============================================================================
#
# Usage:
#   python -m yolo.cli fit --config yolo/config/experiment/debug.yaml
#
# =============================================================================

trainer:
  max_epochs: 5
  accelerator: auto
  devices: 1
  precision: 32
  gradient_clip_val: 10.0
  log_every_n_steps: 10
  check_val_every_n_epoch: 1
  limit_train_batches: 100
  limit_val_batches: 20

  callbacks:
    # Save best model with fixed name
    - class_path: lightning.pytorch.callbacks.ModelCheckpoint
      init_args:
        monitor: val/mAP
        mode: max
        save_top_k: 1
        save_last: true
        filename: "best"
        auto_insert_metric_name: false

    - class_path: yolo.training.callbacks.YOLOProgressBar

    - class_path: yolo.training.callbacks.EvalDashboardCallback
      init_args:
        conf_prod: 0.25
        show_trends: true
        top_n_classes: 3

  logger:
    - class_path: lightning.pytorch.loggers.TensorBoardLogger
      init_args:
        save_dir: runs/
        name: debug

model:
  model_config: v9-c
  num_classes: 80
  image_size: [640, 640]
  learning_rate: 0.01
  momentum: 0.937
  weight_decay: 0.0005
  warmup_epochs: 1
  box_loss_weight: 7.5
  cls_loss_weight: 0.5
  dfl_loss_weight: 1.5
  weight_path: null
  nms_conf_threshold: 0.25
  nms_iou_threshold: 0.65
  nms_max_detections: 300

data:
  root: data/coco
  train_images: train2017
  val_images: val2017
  train_ann: annotations/instances_train2017.json
  val_ann: annotations/instances_val2017.json
  batch_size: 4
  num_workers: 4
  pin_memory: true
  mosaic_prob: 0.0
  mixup_prob: 0.0
  hsv_h: 0.0
  hsv_s: 0.0
  hsv_v: 0.0
  degrees: 0.0
  translate: 0.0
  scale: 0.0
  shear: 0.0
  perspective: 0.0
  flip_lr: 0.0
  flip_ud: 0.0
  close_mosaic_epochs: 0
